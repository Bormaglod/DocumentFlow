{
  "title": "select code || '. ' || name as title from calculation where id = :id",
  "datasets": [
    {
      "name": "org",
      "sql-query": "select full_name as name, inn, kpp, ogrn, address, phone, email from organization where default_org",
      "unique-result": true
    },
    {
      "name": "context",
      "sql-query": "select code, name, case status_id when 1002 then (select to_char(changed, 'DD.MM.YYYY') from history where reference_id = :id order by changed desc limit 1) else 'ÀÐÕÈÂ' end as approved_date from calculation where id = :id",
      "unique-result": true
    },
    {
      "name": "terminals",
      "sql-query": "with recursive tree_goods as (select id, parent_id, name from goods where parent_id = '17f8df70-2ad6-4d97-95db-6425cf3249f0' union all select g.id, g.parent_id, g.name from goods g join tree_goods on (tree_goods.id = g.parent_id)) select g.name, cig.amount from calc_item_goods cig join tree_goods g on (g.id = cig.item_id) where cig.owner_id = :id order by g.name"
    },
    {
      "name": "blocks",
      "sql-query": "with recursive tree_goods as (select id, parent_id, name from goods where parent_id = '2d34202e-159d-467b-9e97-5a0bb5494fa4' union all select g.id, g.parent_id, g.name from goods g join tree_goods on (tree_goods.id = g.parent_id)) select g.name, cig.amount from calc_item_goods cig join tree_goods g on (g.id = cig.item_id) where cig.owner_id = :id order by g.name"
    },
    {
      "name": "tube",
      "sql-query": "with recursive tree_goods as (select id, parent_id, name from goods where parent_id = '1e1ff796-a0a6-4958-8b8a-dd94ea322cfd' union all select g.id, g.parent_id, g.name from goods g join tree_goods on (tree_goods.id = g.parent_id)) select g.name, um.count_by_operation as length, round(sum(um.count_by_goods / um.count_by_operation)) as amount from calc_item_operation cio join used_material um on (um.calc_item_operation_id = cio.id) join tree_goods g on (g.id = um.goods_id) where cio.owner_id = :id group by g.name, um.count_by_goods, um.count_by_operation order by g.name"
    },
    {
      "name": "wire",
      "sql-query": "with recursive tree_goods as (select id, parent_id, name from goods where parent_id = '0525748e-e98c-4296-bd0e-dcacee7224f3' union all select g.id, g.parent_id, g.name from goods g join tree_goods on (tree_goods.id = g.parent_id)) select g.name, um.count_by_operation as length, round(sum(um.count_by_goods / um.count_by_operation)) as amount, o.program, o.left_cleaning, o.left_sweep, o.right_cleaning, o.right_sweep from calc_item_operation cio join used_material um on (um.calc_item_operation_id = cio.id) join tree_goods g on (g.id = um.goods_id) join operation o on (o.id = cio.item_id) where cio.owner_id = :id group by g.name, um.count_by_goods, um.count_by_operation, o.program, o.left_cleaning, o.left_sweep, o.right_cleaning, o.right_sweep order by g.name"
    },
    {
      "name": "other",
      "sql-query": "with recursive tree_goods as (select id, parent_id, name from goods where parent_id = '18802774-8266-4b66-878e-4c43befe8d1e' union all select g.id, g.parent_id, g.name from goods g join tree_goods on (tree_goods.id = g.parent_id)) select g.name, cig.amount from calc_item_goods cig join tree_goods g on (g.id = cig.item_id) where cig.owner_id = :id order by g.name"
    }
  ]
}
