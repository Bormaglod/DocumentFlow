{
  "name": "deduction",
  "viewer": {
    "dataset": {
      "select": "select d.id, d.status_id, s.note as status_name, d.name, case d.accrual_base when 1 then 'Материалы' when 2 then 'ФОТ' else 'не установлено' end as accrual_base, d.percentage from deduction d join status s on (s.id = d.status_id)",
      "select-id": "select d.id, d.status_id, s.note as status_name, d.name, case d.accrual_base when 1 then 'Материалы' when 2 then 'ФОТ' else 'не установлено' end as accrual_base, d.percentage from deduction d join status s on (s.id = d.status_id) where d.id = :id"
    },
    "data-type": "Directory",
    "allow-grouping": true,
    "columns": [
      {
        "datafield": "id",
        "text": "Id",
        "type": "Text",
        "width": 180,
        "visible": false
      },
      {
        "datafield": "status_id",
        "text": "Код состояния",
        "type": "Integer",
        "width": 80,
        "visible": false,
        "allow-grouping": true
      },
      {
        "datafield": "status_note",
        "text": "Состояние",
        "type": "Text",
        "width": 110,
        "visible": false,
        "allow-grouping": true
      },
      {
        "datafield": "name",
        "text": "Наименование",
        "type": "Text",
        "hideable": false,
        "auto-size": true
      },
      {
        "datafield": "accrual_base",
        "text": "База для начисления",
        "type": "Text",
        "width": 160,
        "allow-grouping": true
      },
      {
        "datafield": "percentage",
        "text": "Процент",
        "type": "Numeric",
        "format-mode": "Percent",
        "digits": 2
      }
    ]
  },
  "editor": {
    "dataset": {
      "select": "select id, name, d.accrual_base, d.percentage from deduction d where id = :id",
      "update": "update deduction set name = :name, accrual_base = :accrual_base, percentage = :percentage where id = :id"
    },
    "controls": [
      {
        "type": "TextBox",
        "text": "Наименование",
        "datafield": "name",
        "label-width": 170,
        "edit-width": 400
      },
      {
        "type": "ComboBox",
        "text": "База для начисления",
        "datafield": "accrual_base",
        "label-width": 170,
        "edit-width": 180,
        "items": [
          {
            "key": 1,
            "value": "Материалы"
          },
          {
            "key": 2,
            "value": "ФОТ"
          }
        ]
      },
      {
        "type": "Percent",
        "text": "Процент",
        "datafield": "percentage",
        "decimal-digits": 2,
        "label-width": 170,
        "edit-width": 70
      }
    ],
    "conditions": [
      {
        "controls": [ "name", "accrual_base", "percentage" ],
        "enable": {
          "states": [ "compiled", "is changing" ]
        }
      }
    ]
  }
}