{
  "name": "employee",
  "viewer": {
    "dataset": {
      "select": "select e.id, e.status_id, s.note as status_name, p.name as person_name, okpdtr.name as post_name, e.phone, e.email, case e.post_role when 0 then 'Не определена' when 1 then 'Руководитель' when 2 then 'Гл. бухгалтер' when 3 then 'Служащий' when 4 then 'Рабочий' end as post_role from employee e join status s on (s.id = e.status_id) join person p on (p.id = e.person_id) left join okpdtr on (okpdtr.id = e.post_id) where e.owner_id = :owner_id",
      "select-id": "select e.id, e.status_id, s.note as status_name, p.name as person_name, okpdtr.name as post_name, e.phone, e.email, case e.post_role when 0 then 'Не определена' when 1 then 'Руководитель' when 2 then 'Гл. бухгалтер' when 3 then 'Служащий' when 4 then 'Рабочий' end as post_role from employee e join status s on (s.id = e.status_id) join person p on (p.id = e.person_id) left join okpdtr on (okpdtr.id = e.post_id) where e.id = :id"
    },
    "data-type": "Directory",
    "toolbar": {
      "button-style": "Image",
      "icon-size": "Small"
    },
    "commandbar-visible": false,
    "columns": [
      {
        "datafield": "id",
        "text": "Id",
        "type": "Text",
        "width": 180,
        "visible": false
      },
      {
        "datafield": "status_id",
        "text": "Код состояния",
        "type": "Integer",
        "width": 80,
        "visible": false
      },
      {
        "datafield": "status_name",
        "text": "Состояние",
        "type": "Text",
        "width": 110,
        "visible": false
      },
      {
        "datafield": "person_name",
        "text": "Сотрудник",
        "type": "Text",
        "auto-size": true,
        "hideable": false
      },
      {
        "datafield": "post_name",
        "text": "Должность",
        "type": "Text",
        "width": 300
      },
      {
        "datafield": "phone",
        "text": "Телефон",
        "type": "Text",
        "width": 190
      },
      {
        "datafield": "email",
        "text": "Эл. почта",
        "type": "Text",
        "width": 250
      },
      {
        "datafield": "post_role",
        "text": "Роль",
        "type": "Text",
        "width": 150,
        "visible": false
      }
    ]
  },
  "editor": {
    "dataset": {
      "select": "select e.id, c.name as company_name, p.name, e.person_id, e.post_id, e.phone, e.email, e.post_role from employee e join company c on (c.id = e.owner_id) left join person p on (p.id = e.person_id) where e.id = :id",
      "update": "update employee set person_id = :person_id, post_id = :post_id, phone = :phone, email = :email, post_role = :post_role where id = :id"
    },
    "controls": [
      {
        "type": "TextBox",
        "text": "Организация",
        "datafield": "company_name",
        "label-width": 120,
        "enabled": false
      },
      {
        "type": "ComboBoxData",
        "text": "Сотрудник",
        "datafield": "person_id",
        "label-width": 120,
        "edit-width": 200,
        "dataset": "select id, name from person where status_id = 1002"
      },
      {
        "type": "ComboBoxData",
        "text": "Должность",
        "datafield": "post_id",
        "label-width": 120,
        "edit-width": 300,
        "dataset": "select id, name from okpdtr where status_id = 1001"
      },
      {
        "type": "TextBox",
        "text": "Телефон",
        "datafield": "phone",
        "label-width": 120,
        "edit-width": 190
      },
      {
        "type": "TextBox",
        "dock": "Top",
        "text": "Эл. почта",
        "datafield": "email",
        "label-width": 120,
        "edit-width": 250
      },
      {
        "type": "ComboBox",
        "text": "Роль",
        "datafield": "post_role",
        "label-width": 120,
        "edit-width": 150,
        "items": [
          {
            "key": 0,
            "value": "Не определена"
          },
          {
            "key": 1,
            "value": "Руководитель"
          },
          {
            "key": 2,
            "value": "Гл. бухгалтер"
          },
          {
            "key": 3,
            "value": "Служащий"
          },
          {
            "key": 4,
            "value": "Рабочий"
          }
        ]
      }
    ],
    "conditions": [
      {
        "controls": [ "person_id", "post_id", "phone", "email", "post_role" ],
        "enable": {
          "states": [ "compiled", "is changing" ]
        }
      }
    ]
  }
 }